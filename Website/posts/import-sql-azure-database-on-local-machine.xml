<?xml version="1.0" encoding="utf-8"?>
<post>
  <title>Import SQL Azure database on local machine</title>
  <slug>import-sql-azure-database-on-local-machine</slug>
  <author>Jan</author>
  <pubDate>2012-11-07 17:49:08</pubDate>
  <lastModified>2014-04-25 12:06:07</lastModified>
  <content>&lt;p&gt;At the moment I’m working on a (Orchard) project which is deployed to Windows Azure and uses a SQL Azure database. As my team needed to fix some issues which occurred in the Acceptance and Production environment, I wanted to get a recent database dump so we would be able to reproduce the issues on the development machines.&lt;/p&gt; &lt;p&gt;I couldn’t find an easy way to synchronize the databases or create a backup which I could restore. After doing some extensive searching I discovered there is a way you can restore a SQL Azure database to a local SQL Server 2012 environment.&lt;/p&gt; &lt;p&gt;To do this, you have to create an export in the Azure Management portal and import this export into your SQL Server 2012. I’ll describe the necessary steps below.&lt;/p&gt; &lt;p&gt;First, head to the Azure Management portal and go to the Database tab. On this screen you’ll see the option &lt;em&gt;Export&lt;/em&gt; the database at the bottom of the screen.&lt;/p&gt; &lt;p&gt;&lt;a href="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_4.png"&gt;&lt;img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_thumb_1.png" width="722" height="510"&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;Clicking on this button pops up a modal dialog. In this dialog you need to specify the name of the export, a bacpac file, which storage account you’ll use, container to save the file and the login credentials of the database.&lt;/p&gt; &lt;p&gt;&lt;a href="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_6.png"&gt;&lt;img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_thumb_2.png" width="722" height="510"&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;After you have finished creating the export you still need to download the file. At the moment it’s not possible do this (easilly) via the browser. To download files which are located in the blob storage you’ll need some extra software. I’ve used the free &lt;a href="http://www.cloudberrylab.com/free-microsoft-azure-explorer.aspx"&gt;CloudBerry Windows Azure Explorer&lt;/a&gt; for this.&lt;/p&gt; &lt;p&gt;Once you have logged in to your blob storage account you can download the newly created bacpac-file.&lt;/p&gt; &lt;p&gt;Now, start up your SQL Management Studio. When you right-click on the &lt;em&gt;Databases&lt;/em&gt;-option you’ll see 2 new items, &lt;em&gt;Deploy Data-tier Application&lt;/em&gt; and &lt;em&gt;Import Data-tier Application&lt;/em&gt;. For importing a bacpac file you’ll have to click the second option, &lt;em&gt;Import Data-tier Application.&lt;/em&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_8.png"&gt;&lt;img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_thumb_3.png" width="244" height="219"&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;You’ll be prompted with a friendly introduction screen explaining what this option does.&lt;/p&gt; &lt;p&gt;&lt;a href="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_10.png"&gt;&lt;img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_thumb_4.png" width="470" height="437"&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;When you navigate to the second screen you’ll be prompted to select the bacpac file you want to import.&lt;/p&gt; &lt;p&gt;&lt;a href="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_12.png"&gt;&lt;img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_thumb_5.png" width="472" height="439"&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;As you can see, you can also specify a storage account, container and filename on this page. This means you don’t have to download the bacpac file using some third party Azure Explorer. This is pretty convenient if you don’t want all that software on your system. For now I’ll use the downloaded bacpac file.&lt;/p&gt; &lt;p&gt;&lt;a href="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_14.png"&gt;&lt;img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_thumb_6.png" width="472" height="439"&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;On the next screen you’ll be able to specify the database name and where the database files (mdf and ldf) need to be placed.&lt;/p&gt; &lt;p&gt;&lt;a href="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_16.png"&gt;&lt;img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_thumb_7.png" width="471" height="438"&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;Finish the wizard and once it’s done you’ll see a nice summary of what has been created.&lt;/p&gt; &lt;p&gt;&lt;a href="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_20.png"&gt;&lt;img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_thumb_9.png" width="470" height="436"&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;Refreshing the database node will show you the new database has been created also:&lt;/p&gt; &lt;p&gt;&lt;a href="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_22.png"&gt;&lt;img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://jan-v.nl/Media/Default/Windows-Live-Writer/Import-SQL-Azure-database-on-local-machi_EFFF/image_thumb_10.png" width="305" height="371"&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;By following these steps you’ll be able to get database dumps from Azure into your own development environment. Please note this only works when you are using SQL Server 2012. Earlier versions don’t have this functionality and I doubt it will be added. &lt;/p&gt; &lt;p&gt;On a side note, I advice every developer to upgrade as soon as possible to SQL Server 2012. Restoring databases to earlier states has been made a lot easier. Now everyone can restore a database to a specific point in time. You don’t need to be a SQL guru anymore. So that and all the other improvements SQL Server 2012 brings, I can only say it’s a big step forward!&lt;/p&gt;</content>
  <ispublished>true</ispublished>
  <categories></categories>
  <comments></comments>
</post>