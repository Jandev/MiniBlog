<?xml version="1.0" encoding="utf-8"?>
<post>
  <title>Terminal Server has exceeded the maximum number of allowed connections</title>
  <slug>terminal-server-has-exceeded-the-maximum-number-of-allowed-connections</slug>
  <author>Jan</author>
  <pubDate>2010-11-23 19:21:00</pubDate>
  <lastModified>2014-04-25 12:06:08</lastModified>
  <content>&lt;div class="ExternalClass1150BFA6948147A9A3DD0D3D6C19A2F8"&gt;
&lt;p&gt;Dat is de melding die je zo nu en dan ziet verschijnen bij het overnemen van een server via remote desktop. Tot op heden was m'n enige oplossing hiervoor om met /console in te loggen en wanneer dat ook niet meer werkte, dan maar de server herstarten.&lt;/p&gt;
&lt;p&gt;Vandaag kwam ik dit probleem weer tegen, maar dit keer was het op een host van verschillende VMWare guests. Het was niet echt een optie om de server te herstarten.&lt;/p&gt;
&lt;p&gt;Gelukkig ben ik er nu achter gekomen dat je ook via de commandline de openstaande sessies kunt opvragen en killen.&lt;/p&gt;
&lt;p&gt;Open de command prompt. Let er hier op dat je de deze wel opent als een domein gebruiker als de server op een domein zit, of anders als een gebruiker die ook op de server bekend is. Wanneer je dit niet doet kun je een &lt;em&gt;Access denied&lt;/em&gt; melding krijgen. &lt;br /&gt;&lt;span style="color: white;"&gt;&lt;span style="background-color: black; font-family: Courier New;"&gt;Error 5 getting sessionnames&lt;br /&gt;Error [5]:Access is denied.&lt;/span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Het starten van een applicatie met een ander account kan door de [Shift]+[Rightclick] te doen op de applicatie of snelkoppeling. Je krijgt dan een &lt;em&gt;Run as different user&lt;/em&gt; optie in het context menu (Windows 7). Uiteraard kan er ook gebruik worden gemaakt van de &lt;a href="http://technet.microsoft.com/en-us/sysinternals/cc300361.aspx"&gt;ShellRunas applicatie van Sysinternals&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src="http://weblogjanv/Lists/Photos/112310_1818_TerminalSer1.png" alt="" /&gt;&lt;/p&gt;
&lt;p&gt;In de prompt tik je dan het volgende in &lt;span style="background-color: black; font-family: Courier New; color: white;"&gt;query session /server:servernaam&lt;/span&gt;. Het resultaat is hieronder te zien:&lt;/p&gt;
&lt;p&gt;&lt;img src="http://weblogjanv/Lists/Photos/112310_1818_TerminalSer2.png" alt="" /&gt;&lt;/p&gt;
&lt;p&gt;Dit is een lijst met de (actieve) sessies op de betreffende server.&lt;br /&gt;Het lijkt mij niet vestandig om de sessies van &lt;em&gt;console&lt;/em&gt;, &lt;em&gt;rdp-tcp&lt;/em&gt; af te sluiten.&lt;br /&gt;Van deze betreffende server weet ik dat het &lt;em&gt;beheer&lt;/em&gt; account is ingelogd, wat ook is te zien in de lijst. Deze sessie kan worden afgesloten door middel van het commando &lt;span style="background-color: black; font-family: Courier New; color: white;"&gt;reset session 3 /server:sylvester&lt;/span&gt; uit te voeren. Het sessie id staat in de eerder verkregen lijst.&lt;/p&gt;
&lt;p&gt;Wanneer er nu weer een query wordt uitgevoerd zal te zien zijn dat de sessie ook daadwerkelijk weg is:&lt;/p&gt;
&lt;p&gt;&lt;img src="http://weblogjanv/Lists/Photos/112310_1818_TerminalSer3.png" alt="" /&gt;&lt;/p&gt;
&lt;p&gt;Nu kan er weer worden ingelogd op de server. Dit kan uiteraard ook voor de overige sessies worden herhaald wanneer dat nodig is.&lt;/p&gt;
&lt;/div&gt;</content>
  <ispublished>true</ispublished>
  <categories></categories>
  <comments></comments>
</post>