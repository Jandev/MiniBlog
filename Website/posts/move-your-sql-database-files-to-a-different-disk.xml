<?xml version="1.0" encoding="utf-8"?>
<post>
  <title>Move your SQL database files to a different disk</title>
  <slug>move-your-sql-database-files-to-a-different-disk</slug>
  <author>Jan</author>
  <pubDate>2013-11-20 12:48:11</pubDate>
  <lastModified>2014-04-25 12:06:07</lastModified>
  <content>&lt;p&gt;There comes a time when you have to do something which appears impossible at start. One of the things I had to confront is moving my SQL database files from the D-drive to the L-drive.&lt;/p&gt; &lt;p&gt;Moving regular SQL database files isn’t that hard at all. Just detach the database, move the files to a new location and attach the database again. However, system databases can’t be moved in this way, which makes sense if you think about it. To move the system databases, you need to run some queries. This method is described on &lt;a href="http://msdn.microsoft.com/en-us/library/ms345408(v=sql.90).aspx"&gt;MSDN&lt;/a&gt; and there are also some &lt;a href="http://social.msdn.microsoft.com/Forums/sqlserver/en-US/82bd0c60-fa53-4870-98ec-3aa031e075ca/how-can-i-move-the-system-databases?forum=sqldatabaseengine"&gt;forum posts&lt;/a&gt; which describe the necessary actions.&lt;/p&gt; &lt;p&gt;For future reference, I’ll describe the necessary steps below.&lt;/p&gt; &lt;p&gt;First, stop the SQL Server and add the following to the startup parameters:&lt;/p&gt;&lt;pre class="brush:shell"&gt;-dL:\Databases\MSSQL.1\MSSQL\Data\System\master.mdf;-eL:\Logs\ERRORLOG;-lL:\Databases\MSSQL.1\MSSQL\Data\System\mastlog.ldf
&lt;/pre&gt;
&lt;p&gt;This will make sure the master database files are searched at the new location (&lt;em&gt;L:\Databases\MSSQL.1\MSSQL\Data\System\&lt;/em&gt;)&lt;/p&gt;
&lt;p&gt;Now move the physical master database files to the new location.&lt;/p&gt;
&lt;p&gt;At this moment it’s possible to start SQL Server again by running the following command:&lt;/p&gt;&lt;pre class="brush:shell"&gt;NET START MSSQLSERVER /f /T3608
&lt;/pre&gt;
&lt;p&gt;This will start SQL Server in master-only mode. You can open Management Studio now again and start a new query window (the Object Explorer doesn’t work in this mode) (using SQLCmd wil also work). In this new query window you will have to execute this script to move the databases to the &lt;em&gt;L:\Databases\MSSQL.1\MSSQL\Data\System\&lt;/em&gt; location.&lt;/p&gt;&lt;pre class="brush:sql"&gt;ALTER DATABASE master MODIFY FILE (NAME = master, FILENAME = 'L:\Databases\MSSQL.1\MSSQL\Data\System\master.mdf')
GO
ALTER DATABASE master MODIFY FILE (NAME = mastlog, FILENAME = 'L:\Databases\MSSQL.1\MSSQL\Data\System\mastlog.ldf')
GO
ALTER DATABASE model MODIFY FILE (NAME = modeldev, FILENAME = 'L:\Databases\MSSQL.1\MSSQL\Data\System\model.mdf')
GO
ALTER DATABASE model MODIFY FILE (NAME = modellog, FILENAME = 'L:\Databases\MSSQL.1\MSSQL\Data\System\modellog.ldf')
GO
ALTER DATABASE msdb MODIFY FILE (NAME = MSDBData, FILENAME = 'L:\Databases\MSSQL.1\MSSQL\Data\System\MSDBData.mdf')
GO
ALTER DATABASE msdb MODIFY FILE (NAME = MSDBLog, FILENAME = 'L:\Databases\MSSQL.1\MSSQL\Data\System\MSDBLog.ldf')
GO
ALTER DATABASE tempdb MODIFY FILE (NAME = tempdev, FILENAME = 'L:\Databases\MSSQL.1\MSSQL\Data\System\tempdb.mdf')
GO
ALTER DATABASE tempdb MODIFY FILE (NAME = templog, FILENAME = 'L:\Databases\MSSQL.1\MSSQL\Data\System\templog.ldf')
GO
ALTER DATABASE mssqlsystemresource MODIFY FILE (NAME=data, FILENAME='L:\Databases\MSSQL.1\MSSQL\Data\System\mssqlsystemresource.mdf');
GO
ALTER DATABASE mssqlsystemresource MODIFY FILE (NAME=log, FILENAME='L:\Databases\MSSQL.1\MSSQL\Data\System\mssqlsystemresource.ldf');
GO
&lt;/pre&gt;
&lt;p&gt;After this script has succeeded you can stop the SQL Server instance again.&lt;/p&gt;
&lt;p&gt;Now move all the system database files to the new location, remove the startup parameters and check if all databases have successfully moved to the new location by using the following query.&lt;/p&gt;&lt;pre class="brush:sql"&gt;SELECT name, physical_name, state_desc
FROM sys.master_files
&lt;/pre&gt;
&lt;p&gt;This should produce something similar like the screenshot below.&lt;/p&gt;
&lt;p&gt;&lt;a href="http://jan-v.nl/Media/Default/Windows-Live-Writer/Move-your-SQL-database-files-to-a-differ_A3F9/image_2.png"&gt;&lt;img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://jan-v.nl/Media/Default/Windows-Live-Writer/Move-your-SQL-database-files-to-a-differ_A3F9/image_thumb.png" width="683" height="177"&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Keep in mind, you won’t see the &lt;em&gt;mssqlsystemresource&lt;/em&gt; database in this query, because it’s a &lt;a href="http://blog.sqlauthority.com/2008/07/27/sql-server-mssqlsystemresource-resource-database/"&gt;‘hidden’ database&lt;/a&gt; used for internal operations of SQL Server when you want to upgrade your server.&lt;/p&gt;</content>
  <ispublished>true</ispublished>
  <categories></categories>
  <comments></comments>
</post>